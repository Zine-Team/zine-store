@import "tailwindcss";

@theme {
  --shadow-zine: 0.5px 0.5px 1px lch(0% 0 0 / 0.1), 1px 1px 12px -4px lch(0% 0 0 / 0.2);
  --shadow-page: 0.33px 0.33px 1px lch(0% 0 0 / 0.1), 0.75px 0.75px 0.75px lch(0% 0 0 / 0.1);

  --color-gainsboro: Gainsboro;
  --color-link: #0000ee;
  --color-link-visited: #551a8b;
  --color-dark-grey: DarkGray;
  --color-ghost-white: GhostWhite;
  --color-white-smoke: WhiteSmoke;

  --spacing-site-padding: max(1.5rem, 3vw);

  --perspective-zine: 2000px;
  --duration-zine: 1000ms;
  --aspect-zine: 5.5 / 4.25;
  --ease-zine: cubic-bezier(0, 0, 0.2, 1);

  --radius-xs: 3px;

  --text-base: 18px;
  --text-lg: 20px;
  --text-xl: 22px;
  --text-2xl: 26px;
  --text-3xl: 40px;
}

@layer components {
  .zine-store-container {
    width: 100%;
    max-width: 1400px;
    padding-inline-start: var(--spacing-site-padding);
    padding-inline-end: var(--spacing-site-padding);
    overflow: hidden;
  }

  .navigation-button {
    font-size: 20px;
    line-height: 1;
    block-size: max(25%, 72px);
    inline-size: 64px;
    font-weight: bold;
    flex-shrink: 0;

    &[data-action="prev-narrow"],
    &[data-action="next-narrow"] {
      display: none;
    }
  }

  /* the element with the perspective effect */
  [data-zine-part="outer"] {
    transform: rotateX(calc(1deg * var(--aimY))) rotateY(calc(1deg * var(--aimX)));
  }

  /* the actual "zine". The parent element of all the pages */
  [data-zine-part="spread"] {
    transition: transform calc(var(--duration-zine) * 0.75) var(--ease-zine);

    /* these lines position the zine centered when it's closed */
    &.front-cover {
      transform: translateX(-25%);
    }

    &.back-cover {
      transform: translateX(25%);
    }
  }

  /* this is zine shadow that moves with the perspective effect */
  [data-zine-part="spread"]::before {
    content: "";
    position: absolute;
    width: 100%;
    top: 0;
    bottom: 0;
    background: black;
    filter: blur(20px);
    opacity: 0.2;
    --duration-multiplier: 0.3;
    --rotateX: rotateX(calc(2deg * var(--aimY)));
    --rotateY: rotateY(calc(2deg * var(--aimX)));
    --scaleX: scaleX(calc((0.5% * max(var(--aimX), -1 * var(--aimX)) + 100%)));
    --scaleY: scaleY(calc((0.5% * max(var(--aimY), -1 * var(--aimY)) + 100%)));
    will-change: width;
    transform: var(--rotateX) var(--rotateY) var(--scaleX) var(--scaleY);
    transition: width calc(var(--duration-zine) * var(--duration-multiplier)) var(--ease-zine);
  }

  /* shadow delay when aninmating from the front cover to the first spread */
  [data-zine-part="spread"]:not(.back-cover)[data-direction="increment"]::before {
    right: 0;
    --duration-multiplier: 0.75;
    transition-delay: calc(var(--duration-zine) * 0.175);
  }

  /* shadow delay when aninmating from the back cover to the final spread */
  [data-zine-part="spread"]:not(.front-cover)[data-direction="decrement"]::before {
    --duration-multiplier: 0.75;
    transition-delay: calc(var(--duration-zine) * 0.175);
  }

  /* shadow positioning when on the front cover */
  [data-zine-part="spread"].front-cover::before {
    width: 50%;
    right: 0;
  }

  /* shadow positioning when on the back cover */
  [data-zine-part="spread"].back-cover::before {
    width: 50%;
    left: 0;
  }

  [data-zine-part="page"] {
    display: none;
    box-shadow: var(--page-shadow), var(--zine-shadow);

    &.visible {
      display: block;
    }
  }

  /* when navigating forward through the zine... */
  [data-zine-part="spread"][data-direction="increment"] [data-zine-part="page"] {
    /* left pages */
    &:nth-child(even) {
      &.animatingIn {
        animation: leftPageFlipLeft var(--duration-zine) var(--ease-zine);
      }

      &.animatingOut {
        animation: leftPageGetCovered var(--duration-zine) var(--ease-zine);
      }
    }

    /* right pages */
    &:nth-child(odd) {
      &.animatingOut {
        animation: rightPageFlipLeft var(--duration-zine) var(--ease-zine);
      }
    }
  }

  /* when navigating backward through the zine... */
  [data-zine-part="spread"][data-direction="decrement"] [data-zine-part="page"] {
    /* left pages */
    &:nth-child(even) {
      &.animatingOut {
        animation: leftPageFlipRight var(--duration-zine) var(--ease-zine);
      }
    }

    /* right pages */
    &:nth-child(odd) {
      &.animatingIn {
        animation: rightPageFlipRight var(--duration-zine) var(--ease-zine);
      }

      &.animatingOut {
        animation: rightPageGetCovered var(--duration-zine) var(--ease-zine);
      }
    }
  }

  /* gradient overlay on right pages */
  [data-zine-part="page"]:nth-child(odd)::after {
    content: "";
    position: absolute;
    inset: 0;
    opacity: 5%;
    background-image: linear-gradient(to right, black, transparent 75%);
  }

  /* middle screen size */
  @media screen and (max-width: 950px) {
    .zine-navigator {
      gap: 1rem;
      display: grid;
      grid-template-columns: 1fr 1fr;
      justify-items: center;

      & .zine-root {
        grid-column: 1 / 3;
      }
      & .navigation-button {
        grid-row: 2;
      }
    }

    .navigation-button {
      width: max(50%, 125px);
      max-width: 100%;
    }
  }

  /* narrow screen size */
  @media screen and (max-width: 768px) {
    /* .navigation-button[data-action="prev-wide"],
    .navigation-button[data-action="next-wide"] {
      display: none;
    }

    .navigation-button[data-action="prev-narrow"],
    .navigation-button[data-action="next-narrow"] {
      display: block;
    } */

    /* [data-zine-part="outer"] {
      transform: none;
    } */

    [data-zine-part="spread"] {
      --narrow-width: 185%;
      width: var(--narrow-width);
      /* justify-self: start; */
      /* flex-shrink: 0; */
      transform: none;

      &.right:not(.front-cover) {
        transform: translateX(calc(-1 * var(--narrow-width) / 4));
      }

      &.front-cover {
        transform: translateX(calc((-1 * var(--narrow-width) / 4) - (200% - var(--narrow-width)) / 8));
      }

      &.back-cover {
        transform: translateX(calc((200% - var(--narrow-width)) / 8));
      }
    }
  }

  /* keyframes */
  @keyframes rightPageFlipLeft {
    from {
      display: block;
      z-index: 2;
    }
    to {
      transform: rotateY(-180deg);
    }
  }

  @keyframes rightPageFlipRight {
    from {
      transform: rotateY(-180deg);
    }
    to {
      display: block;
      z-index: 2;
    }
  }

  @keyframes rightPageGetCovered {
    from {
      display: block;
    }
  }

  @keyframes leftPageFlipLeft {
    from {
      transform: rotateY(180deg);
    }
  }

  @keyframes leftPageFlipRight {
    from {
      display: block;
      z-index: 2;
    }
    to {
      transform: rotateY(180deg);
    }
  }

  @keyframes leftPageGetCovered {
    from {
      display: block;
    }
  }
}
